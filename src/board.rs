use std::cell::RefCell;
use std::rc::Rc;
use crate::{Battlesnake, Coord};

#[derive(Debug, Clone, PartialEq, Eq)]
pub enum CellContent {
    Food,
    Snake(String),
    Hazard,
    Empty,
}

#[derive(Debug, Clone, PartialEq, Eq, Copy)]
pub enum Direction {
    Up,
    Down,
    Left,
    Right,
    None,
}

#[derive(Debug, Clone, PartialEq, Eq)]
pub struct Action {
    pub(crate) snake_id: String,
    pub(crate) direction: Direction,
    pub(crate) old_tail: Coord,
    // pub(crate) secondLastTail: Coord,
    pub(crate) new_head: Coord,
    pub(crate) old_head: Coord,
    pub(crate) ate_food: bool,
    pub(crate) old_health: i32,
}

#[derive(Debug, Clone)]
pub struct GameBoard {
    pub(crate) width: i32,
    pub(crate) height: i32,
    pub(crate) matrix: Vec<Vec<CellContent>>,
    pub(crate) snakes: Vec<Rc<RefCell<Battlesnake>>>,
    pub(crate) history: Vec<Action>,
    pub(crate) zobrist_hash: u64,
    pub(crate) health_zobrist_table: Vec<u64>,
    pub(crate) zobrist_table: Vec<u64>,
    pub(crate) boolboard: [[bool; 11]; 11],
    pub(crate) headboard: [[i32; 11]; 11],
    pub(crate) board_hash: u128,
    move_map: [Vec<Direction>; 4096],
}

impl GameBoard {
    pub fn new(width: i32, height: i32, food: Vec<Coord>, snakes: Vec<Battlesnake>, hazards: Vec<Coord>,
               zobrist_table: &Vec<u64>, health_zobrist_table: &Vec<u64>) -> Self {
        let mut matrix = vec![vec![CellContent::Empty; height as usize]; width as usize];

        // let mut zobrist_table = Vec::new();
        // let mut health_zobrist_table = Vec::new();
        // let mut rng = rand::thread_rng();
        // for _ in 0..(width * height * 2) {
        //     zobrist_table.push(rng.gen());
        // }
        // for _ in 0..100 {
        //     health_zobrist_table.push(rng.gen());
        // }

        let mut zobrist_hash: u64 = 0;
        let mut boolboard: [[bool; 11]; 11] = [[false; 11]; 11];
        let mut headboard: [[i32; 11]; 11] = [[0; 11]; 11];

        let mut board_hash: u128 = 0;

        for coord in &food {
            matrix[coord.x as usize][coord.y as usize] = CellContent::Food;
            // Food hashes
            zobrist_hash ^= zobrist_table[((coord.x * height * 2) + (coord.y * 2) + 0) as usize];
            board_hash ^= 1 << (coord.x * height + coord.y);
        }

        let mut ref_snakes = Vec::new();
        for snake in snakes {
            zobrist_hash ^= health_zobrist_table[(snake.health - 1) as usize];
            let ref_snake = Rc::new(RefCell::new(snake.clone()));
            ref_snakes.push(ref_snake.clone());

            let mut i = 0;
            for coord in &snake.body {
                matrix[coord.x as usize][coord.y as usize] = CellContent::Snake(snake.id.clone());

                // Snake hashes
                zobrist_hash ^= zobrist_table[((coord.x * height * 2) + (coord.y * 2) + 1) as usize];
                board_hash ^= 1 << (coord.x * height + coord.y);

                // Passability boolboard
                if i < snake.length - 1 {
                    boolboard[coord.x as usize][coord.y as usize] = true;
                }
                if i == 0 {
                    headboard[coord.x as usize][coord.y as usize] = snake.length.clone();
                }


                i += 1;
            }
        }

        for coord in hazards {
            matrix[coord.x as usize][coord.y as usize] = CellContent::Hazard;
        }


        Self {
            width,
            height,
            matrix,
            snakes: ref_snakes,
            history: Vec::new(), // Initialize history
            zobrist_hash: zobrist_hash,
            health_zobrist_table: health_zobrist_table.clone(),
            zobrist_table: zobrist_table.clone(),
            boolboard: boolboard,
            headboard: headboard,
            board_hash: board_hash,
            // First 4 bits for obstacles that are UP, LEFT, DOWN, RIGHT (in that order)
            // Next 8 bits are for snake heads that are of dist 2 away (Manhattan)
            // Order is:
            // UP-UP, UP-LEFT, LEFT-LEFT, DOWN-LEFT, DOWN-DOWN, DOWN-RIGHT, RIGHT-RIGHT, UP-RIGHT
            move_map: [
                vec![Direction::Up, Direction::Left, Direction::Down, Direction::Right],
                vec![Direction::Left, Direction::Down, Direction::Right],
                vec![Direction::Up, Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Up, Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left, Direction::Down, Direction::Right],
                vec![Direction::Left, Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Up, Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Down, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Left, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up, Direction::Right],
                vec![Direction::Right],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![Direction::Right],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up, Direction::Left],
                vec![Direction::Left],
                vec![Direction::Up],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![Direction::Up],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Left, Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![Direction::Down],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![Direction::Left],
                vec![Direction::Left],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
                vec![],
            ],
        }
    }

    pub fn move_snake(&mut self, snake: Rc<RefCell<Battlesnake>>, direction: Direction) -> bool {
        let start_time = std::time::Instant::now();
        let mut borrow = snake.borrow_mut();

        let mut action: Action = Action {
            snake_id: borrow.id.clone(),
            direction: direction.clone(),
            old_tail: Coord { x: 0, y: 0 },
            new_head: Coord { x: 0, y: 0 },
            old_head: Coord { x: 0, y: 0 },
            ate_food: false,
            old_health: borrow.health.clone(),
        };

        let old_head = borrow.head.clone();
        action.old_head = old_head.clone();

        let new_head = match direction {
            Direction::Up => Coord { x: old_head.clone().x, y: old_head.clone().y + 1 },
            Direction::Down => Coord { x: old_head.clone().x, y: old_head.clone().y - 1 },
            Direction::Left => Coord { x: old_head.clone().x - 1, y: old_head.clone().y },
            Direction::Right => Coord { x: old_head.clone().x + 1, y: old_head.clone().y },
            Direction::None => {
                println!("ERROR, tried to move a snake with Direction::None");
                old_head.clone()
            }
        };

        action.new_head = new_head.clone();
        self.headboard[old_head.x as usize][old_head.y as usize] = 0;
        self.headboard[new_head.x as usize][new_head.y as usize] = borrow.length.clone();

        // Add new head to the snake body
        borrow.body.insert(0, new_head.clone());
        borrow.head = new_head.clone();

        // Remove the tail of the snake
        let old_tail = borrow.body.pop().unwrap();
        action.old_tail = old_tail.clone();

        self.zobrist_hash ^= self.health_zobrist_table[(borrow.health - 1) as usize];
        borrow.health -= 1;

        // Check if snake stepped on food
        if self.matrix[new_head.x as usize][new_head.y as usize] == CellContent::Food {
            borrow.health = 100; // Refill health
            self.zobrist_hash ^= self.health_zobrist_table[(borrow.health - 1) as usize];
            borrow.body.push(old_tail.clone()); // Make the snake longer fatass
            borrow.length += 1;
            action.ate_food = true;
            self.zobrist_hash ^= self.zobrist_table[((new_head.x * self.height * 2) + (new_head.y * 2) + 0) as usize];

            self.zobrist_hash ^= self.zobrist_table[((old_tail.x * self.height * 2) + (old_tail.y * 2) + 1) as usize];
        } else {
            if borrow.health > 0 {
                self.zobrist_hash ^= self.health_zobrist_table[(borrow.health - 1) as usize];
            }
            let new_tail = borrow.body.last().unwrap().clone();
            self.boolboard[new_tail.x as usize][new_tail.y as usize] = false;
            action.ate_food = false;
        }

        // no need to worry about health

        // TODO handle hazards

        // Update the game board
        // removing the old tail MUST GO FIRST
        self.matrix[old_tail.x as usize][old_tail.y as usize] = CellContent::Empty;
        self.zobrist_hash ^= self.zobrist_table[((old_tail.x * self.height * 2) + (old_tail.y * 2) + 1) as usize];
        self.board_hash ^= 1 << (old_tail.x * self.height + old_tail.y);

        self.matrix[new_head.x as usize][new_head.y as usize] = CellContent::Snake(borrow.id.clone());
        self.zobrist_hash ^= self.zobrist_table[((new_head.x * self.height * 2) + (new_head.y * 2) + 1) as usize];
        self.board_hash ^= 1 << (new_head.x * self.height + new_head.y);

        self.boolboard[new_head.x as usize][new_head.y as usize] = true;

        self.history.push(action.clone());

        // println!("Move took: {:?}", start_time.elapsed());
        return true;
    }

    pub fn undo_move(&mut self, snake: Rc<RefCell<Battlesnake>>) {
        if let Some(action) = self.history.pop() {
            let start_time = std::time::Instant::now();
            // let snake = self.get_snake(&action.snake_id).clone();
            let mut borrow = snake.borrow_mut();

            self.zobrist_hash ^= self.zobrist_table[((action.new_head.x * self.height * 2) + (action.new_head.y * 2) + 1) as usize];
            self.board_hash ^= 1 << (action.new_head.x * self.height + action.new_head.y);

            if action.ate_food {
                self.matrix[action.new_head.x as usize][action.new_head.y as usize] = CellContent::Food;
                self.zobrist_hash ^= self.zobrist_table[((action.new_head.x * self.height * 2) + (action.new_head.y * 2) + 0) as usize];
                borrow.length -= 1;

                self.zobrist_hash ^= self.zobrist_table[((action.old_tail.x * self.height * 2) + (action.old_tail.y * 2) + 1) as usize];
                self.board_hash ^= 1 << (action.old_tail.x * self.height + action.old_tail.y);
            } else {
                self.matrix[action.new_head.x as usize][action.new_head.y as usize] = CellContent::Empty;
                let new_tail = borrow.body.last().unwrap().clone();
                borrow.body.push(action.old_tail.clone());
                self.boolboard[new_tail.x as usize][new_tail.y as usize] = true;
            }
            self.boolboard[action.new_head.x as usize][action.new_head.y as usize] = false;

            self.matrix[action.old_tail.x as usize][action.old_tail.y as usize] = CellContent::Snake(borrow.id.clone());
            self.zobrist_hash ^= self.zobrist_table[((action.old_tail.x * self.height * 2) + (action.old_tail.y * 2) + 1) as usize];
            self.board_hash ^= 1 << (action.old_tail.x * self.height + action.old_tail.y);

            if borrow.health > 0 {
                self.zobrist_hash ^= self.health_zobrist_table[(borrow.health - 1) as usize];
            }

            borrow.health = action.old_health.clone();
            self.zobrist_hash ^= self.health_zobrist_table[(borrow.health - 1) as usize];

            self.headboard[action.new_head.x as usize][action.new_head.y as usize] = 0;
            self.headboard[action.old_head.x as usize][action.old_head.y as usize] = borrow.length.clone();

            borrow.body.remove(0);
            borrow.head = action.old_head.clone();
            // println!("Undo took: {:?}", start_time.elapsed());
        }
    }

    pub fn generate_possible_moves(&self, snake: Rc<RefCell<Battlesnake>>) -> Vec<Direction> {
        let start_time = std::time::Instant::now();

        let mut num = 0;

        let old_head = snake.borrow().head.clone();
        let up_x = old_head.x;
        let up_y = old_head.y + 1;
        let left_x = old_head.x - 1;
        let left_y = old_head.y;
        let down_x = old_head.x;
        let down_y = old_head.y - 1;
        let right_x = old_head.x + 1;
        let right_y = old_head.y;

        if up_y >= self.height
            || self.boolboard[up_x as usize][up_y as usize] {
            num |= 1 << 0;
        }
        if left_x < 0
            || self.boolboard[left_x as usize][left_y as usize] {
            num |= 1 << 1;
        }
        if down_y < 0
            || self.boolboard[down_x as usize][down_y as usize] {
            num |= 1 << 2;
        }
        if right_x >= self.width
            || self.boolboard[right_x as usize][right_y as usize] {
            num |= 1 << 3;
        }

        let up_up_x = old_head.x;
        let up_up_y = old_head.y + 2;
        let up_left_x = old_head.x - 1;
        let up_left_y = old_head.y + 1;
        let left_left_x = old_head.x - 2;
        let left_left_y = old_head.y;
        let left_down_x = old_head.x - 1;
        let left_down_y = old_head.y - 1;
        let down_down_x = old_head.x;
        let down_down_y = old_head.y - 2;
        let down_right_x = old_head.x + 1;
        let down_right_y = old_head.y - 1;
        let right_right_x = old_head.x + 2;
        let right_right_y = old_head.y;
        let up_right_x = old_head.x + 1;
        let up_right_y = old_head.y + 1;

        // TODO when it's time to deploy, make this >= and not >
        if up_up_y < self.height
            && self.headboard[up_up_x as usize][up_up_y as usize] >= snake.borrow().length {
            num |= 1 << 4;
        }
        if up_left_x >= 0 && up_left_y < self.height
            && self.headboard[up_left_x as usize][up_left_y as usize] >= snake.borrow().length {
            num |= 1 << 5;
        }
        if left_left_x >= 0
            && self.headboard[left_left_x as usize][left_left_y as usize] >= snake.borrow().length {
            num |= 1 << 6;
        }
        if left_down_x >= 0 && left_down_y >= 0
            && self.headboard[left_down_x as usize][left_down_y as usize] >= snake.borrow().length {
            num |= 1 << 7;
        }
        if down_down_y >= 0
            && self.headboard[down_down_x as usize][down_down_y as usize] >= snake.borrow().length {
            num |= 1 << 8;
        }
        if down_right_x < self.width && down_right_y >= 0
            && self.headboard[down_right_x as usize][down_right_y as usize] >= snake.borrow().length {
            num |= 1 << 9;
        }
        if right_right_x < self.width
            && self.headboard[right_right_x as usize][right_right_y as usize] >= snake.borrow().length {
            num |= 1 << 10;
        }
        if up_right_x < self.width && up_right_y < self.height
            && self.headboard[up_right_x as usize][up_right_y as usize] >= snake.borrow().length {
            num |= 1 << 11;
        }

        // println!("Generate possible moves took: {:?}", start_time.elapsed());
        self.move_map[num].clone()
    }

    pub fn get_snake(&self, snake_id: &str) -> &Rc<RefCell<Battlesnake>> {
        self.snakes.iter().find(|s| s.borrow().id == snake_id).unwrap()
    }

    pub fn clone(&self) -> Self {
        let matrix = self.matrix.clone();
        let width = self.width.clone();
        let height = self.height.clone();

        let snakes = self.snakes.iter().map(|snake| {
            let snake_clone = snake.borrow().clone();
            Rc::new(RefCell::new(snake_clone))
        }).collect();

        let history = self.history.clone();

        Self {
            width,
            height,
            matrix,
            snakes,
            history,
            zobrist_hash: self.zobrist_hash.clone(),
            health_zobrist_table: self.health_zobrist_table.clone(),
            zobrist_table: self.zobrist_table.clone(),
            boolboard: self.boolboard.clone(),
            headboard: self.headboard.clone(),
            move_map: self.move_map.clone(),
            board_hash: self.board_hash.clone(),
        }
    }
}